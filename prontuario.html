<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prontuário Unificado</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <nav class="navbar navbar-dark bg-primary shadow-sm">
        <div class="container">
            <span class="navbar-brand mb-0 h1"><i class="bi bi-heart-pulse-fill"></i> SUHS Emergência</span>
            <span class="text-white small">Dr. Rafael Simões (CRM/MT 9999)</span>
        </div>
    </nav>

    <div class="container mt-4">
        
        <div class="card mb-4 border-0 shadow-sm animate-up">
            <div class="card-body d-flex align-items-center">
                <div class="bg-light rounded-circle p-3 me-3 text-secondary">
                    <i class="bi bi-person-fill h2 m-0"></i>
                </div>
                <div>
                    <h4 class="mb-0 placeholder-glow">
                        <span id="nomePaciente" class="placeholder col-12">Carregando Identidade...</span>
                    </h4>
                    <small class="text-muted" id="uuidPaciente">Aguardando resposta do serviço...</small>
                </div>
                <div class="ms-auto text-end d-none d-md-block">
                    <span class="badge bg-secondary">Status: Ativo</span>
                    <br><small class="text-muted">Ult. Atualização: Hoje</small>
                </div>
            </div>
        </div>

        <div id="boxAlergias" class="alert alert-secondary d-flex align-items-center shadow-sm" role="alert">
            <div class="spinner-border spinner-border-sm me-3" role="status"></div>
            <div>Consultando <strong>Serviço de Alergias</strong>...</div>
        </div>

        <div class="row">
            <div class="col-md-6 mb-4">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-header bg-white fw-bold text-primary border-bottom-0 pt-3">
                        <i class="bi bi-capsule"></i> Medicamentos em Uso
                    </div>
                    <ul class="list-group list-group-flush" id="listaMedicamentos">
                        <li class="list-group-item text-muted py-4 text-center">
                            <div class="spinner-border text-primary" role="status"></div>
                            <div class="small mt-2">Buscando histórico...</div>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="col-md-6 mb-4">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-header bg-white fw-bold text-success border-bottom-0 pt-3">
                        <i class="bi bi-shield-check"></i> Carteira de Vacinação
                    </div>
                    <ul class="list-group list-group-flush" id="listaVacinas">
                        <li class="list-group-item text-muted py-4 text-center">
                            <div class="spinner-grow text-success" role="status"></div>
                            <div class="small mt-2">Sincronizando dados externos...</div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="text-center mt-3 mb-5">
             <button class="btn btn-outline-secondary btn-sm" onclick="alert('Esta função chamaria o LabService para gerar tokens de visualização.')">
                <i class="bi bi-file-earmark-pdf"></i> Ver Laudos de Exames
             </button>
        </div>
    </div>

    <script>
        // CONTROLADOR SIMULADO (ClinicalSummaryController)
        
        const params = new URLSearchParams(window.location.search);
        const uuid = params.get('uuid') || '...';
        
        // 1. Identidade (Rápido)
        setTimeout(() => {
            document.getElementById('nomePaciente').className = '';
            document.getElementById('nomePaciente').innerText = 'MARIA DA SILVA SANTOS';
            document.getElementById('uuidPaciente').innerText = 'UUID: ' + uuid;
        }, 600);

        // 2. Alergias (Crítico - Médio)
        setTimeout(() => {
            const box = document.getElementById('boxAlergias');
            box.className = 'alert alert-danger d-flex align-items-center shadow-sm animate-up';
            box.innerHTML = `
                <i class="bi bi-exclamation-triangle-fill text-danger me-3 h4 m-0"></i>
                <div>
                    <strong>ALERTA DE RISCO:</strong> Paciente alérgico a <span class="text-uppercase fw-bold">Dipirona</span> e <span class="text-uppercase fw-bold">Sulfa</span>.
                </div>`;
        }, 1200);

        // 3. Medicamentos (Normal)
        setTimeout(() => {
            const lista = document.getElementById('listaMedicamentos');
            lista.innerHTML = `
                <li class="list-group-item d-flex justify-content-between align-items-center animate-up">
                    Losartana Potássica <span class="badge bg-primary rounded-pill">50mg</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center animate-up">
                    Metformina <span class="badge bg-primary rounded-pill">850mg</span>
                </li>`;
        }, 1800);

        // 4. Vacinas (Lento - Simula sistema externo/legado)
        setTimeout(() => {
            const lista = document.getElementById('listaVacinas');
            lista.innerHTML = `
                <li class="list-group-item animate-up">
                    <div class="fw-bold">COVID-19 (Pfizer) Bivalente</div>
                    <small class="text-muted">Aplicação: 15/01/2024 (UBS Centro)</small>
                </li>
                <li class="list-group-item animate-up">
                    <div class="fw-bold">Influenza Tetra</div>
                    <small class="text-muted">Aplicação: 10/03/2024 (Clínica Privada)</small>
                </li>`;
        }, 3000); // 3 segundos de delay proposital
    </script>
</body>
</html>
